#!/bin/sh
#
#  (c) 2018-2020 m4r35n357@gmail.com (Ian Smith), for licencing see the LICENCE file
#
#  Example: ./ic .001 ./tsm-thomas-static 15 10 0.1 30000 1 0 0 .185
#

echo "Sensitivity to Initial Conditions: [$*]" >&2

fileA='/tmp/dataA'
fileB='/tmp/dataB'
fileC='/tmp/dataC'
fileD='/tmp/dataD'
fileE='/tmp/dataE'
fileF='/tmp/dataF'
fileG='/tmp/dataG'

delta=$1
shift

perturb () {
    start="$1 $2 $3 $4 $5"
    x0=$6
    y0=$7
    z0=$8
    shift 8
    end="$*"
    echo 'oo' $start $x0 $y0 $z0 $end
    $start $x0 $y0 $z0 $end >$fileG &
    y=$y0
    z=$z0
    x=$(echo "scale=32; $x0 + $delta;" | /usr/bin/bc)
    echo 'x+' $start $x $y $z $end
    $start $x $y $z $end >$fileA &
    x=$(echo "scale=32; $x0 - $delta;" | /usr/bin/bc)
    echo 'x-' $start $x $y $z $end
    $start $x $y $z $end >$fileB &
    x=$x0
    z=$z0
    y=$(echo "scale=32; $y0 + $delta;" | /usr/bin/bc)
    echo 'y+' $start $x $y $z $end
    $start $x $y $z $end >$fileC &
    y=$(echo "scale=32; $y0 - $delta;" | /usr/bin/bc)
    echo 'y-' $start $x $y $z $end
    $start $x $y $z $end >$fileD &
    x=$x0
    y=$y0
    z=$(echo "scale=32; $z0 + $delta;" | /usr/bin/bc)
    echo 'z+' $start $x $y $z $end
    $start $x $y $z $end >$fileE &
    z=$(echo "scale=32; $z0 - $delta;" | /usr/bin/bc)
    echo 'z-' $start $x $y $z $end
    $start $x $y $z $end >$fileF &
}

perturb $*
wait

/usr/bin/gnuplot -e "set title \"$*\"; set terminal png size 1200,900; splot '$fileG' with lines" >/tmp/ic.png

./plot3d.py $fileA $fileB $fileC $fileD $fileE $fileF $fileG

