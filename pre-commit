#!/bin/sh

echo -n "Running Clang build . . . "
./clean
./build clang >/dev/null

echo "Running Taylor Test . . . "
for x in 1 0 -1
do
    if ! ./libad-test-dbg 32 20 $x 1e-21 0 >/dev/null
    then
        echo "Taylor Test failed!"
        exit 1
    fi
done
echo OK

echo -n "Running Lorenz executables . . . "
if ! ./tsm-lorenz-dbg 0 16 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 >/dev/null 2>&1
then
    echo "Lorenz(DBG) failed!"
    exit 1
fi
echo -n "Debug, "

if ! ./tsm-lorenz-static 0 16 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 >/dev/null 2>&1
then
    echo "Lorenz(STATIC) failed!"
    exit 1
fi
echo -n "Static, "

if ! ./tsm-lorenz-dynamic 0 16 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 >/dev/null 2>&1
then
    echo "Lorenz(DYNAMIC) failed!"
    exit 1
fi
echo Dynamic OK

echo -n "Running Rabinovich-Fabrikant executable . . . "
if [ 50001 -ne $(./tsm-rf-dbg 9 32 16 .01 50000 .05 -.05 .3 .105 .1 2>/dev/null | wc -l) ]
then
    echo "Rabinovich-Fabrikant test failed!"
    exit 1
fi
echo OK

echo "Committing . . ."
exit 0
