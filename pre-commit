#!/bin/sh

echo "Running Python tests . . . "
if ! pytest ad_test.py solver_test.py -q
then
    echo "Python tests failed!"
    exit 1
fi
echo OK

echo -n "Running Clang build . . . "
./clean
./build clang >/dev/null

echo "Running Dual Test . . . "
for x in 1 0 -1
do
    if ! ./libdual-test-dbg $x 1e-12 0
    then
        echo "Dual Test failed!"
        exit 1
    fi
done
echo OK

echo "Running Taylor Test . . . "
for x in 1 0 -1
do
    if ! ./libad-test-dbg 10 $x 1e-12 0 >/dev/null
    then
        echo "\033[31;1mTaylor Test failed!\033[0m"
        exit 1
    fi
done
echo OK

echo -n "Running Lorenz executables . . . "
if ! ./tsm-lorenz-dbg 9 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 >/dev/null 2>&1
then
    echo "\033[31;1mLorenz(DBG) failed!\033[0m"
    exit 1
fi
echo -n "Debug"

if ! ./tsm-lorenz-static 9 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 >/dev/null 2>&1
then
    echo "\033[31;1mLorenz(STATIC) failed!\033[0m"
    exit 1
fi
echo ", Static OK"

echo -n "Running Rabinovich-Fabrikant executable . . . "
if [ 50001 -ne $(./tsm-rf-dbg 9 16 .01 50000 .05 -.05 .3 .105 .1 2>/dev/null | wc -l) ]
then
    echo "\033[31;1mRabinovich-Fabrikant test failed!\033[0m"
    exit 1
fi
echo OK

echo "\033[37;1mCommitting . . .\033[0m"
exit 0
