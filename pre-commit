#!/bin/sh

echo -n "Full clean & rebuild . . . "
make -s depclean
make -s -j 4 all
echo "OK"

echo -n "Run tests . . . "
for x in .5 0 -.5
do
    if ! ./libdual-test $x 1e-12 0 2>/dev/null
    then
        echo "\033[31;1mDual Test failed!\033[0m"
        exit 1
    fi

    if ! ./libad-test 10 $x 1e-12 0 >/dev/null 2>/dev/null
    then
        echo "\033[31;1mTaylor Test failed!\033[0m"
        exit 1
    fi
done
echo "OK"

echo -n "Running Lorenz executable . . . "
if [ 10001 -ne $(./tsm-lorenz-std 9 16 .01 10000 -15.8 -17.48 35.64 10 28 8 3 2>/dev/null | wc -l) ]
then
    echo "\033[31;1mLorenz failed!\033[0m"
    exit 1
fi
echo "OK"

echo -n "Running Rabinovich-Fabrikant executable . . . "
if [ 50001 -ne $(./tsm-rf-std 9 16 .01 50000 .05 -.05 .3 .105 .1 2>/dev/null | wc -l) ]
then
    echo "\033[31;1mRabinovich-Fabrikant test failed!\033[0m"
    exit 1
fi
echo "OK"

echo -n "Running Three-body executable . . . "
if [ 10001 -ne $(./h-nbody-std 6 8 0.010 10000 1 1.0 -1.6 0.0 0.0 0.08058 0.58884 0.2 1.0 1.6 0.0 0.0 0.08058 0.58884 -0.2 1.0 0.0 0.0 0.0 -0.16116 -1.17768 0.0 2>/dev/null | wc -l) ]
then
    echo "\033[31;1mThree-body failed!\033[0m"
    exit 1
fi
echo "OK"

echo -n "Running Kerr executable . . . "
if [ 10001 -ne $(./h-kerr-std 6 8 .01 10000 0 0.8 1.0 0.9455050956749083 1.434374509531738 1.0 7.978759958927879 12.0 63.0 2>/dev/null | wc -l) ]
then
    echo "\033[31;1mKerr failed!\033[0m"
    exit 1
fi
echo "OK"

echo "\033[37;1mCommitting . . .\033[0m"
exit 0
