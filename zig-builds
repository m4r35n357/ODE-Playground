#!/bin/sh
set -e
#
#  Example: ./zig-builds arm-linux-musleabihf ReleaseFast tsm-*.c
#  Example: ./zig-builds aarch64-linux-musl ReleaseFast tsm-*.c
#  Example: ./zig-builds x86_64-linux-musl ReleaseFast tsm-*.c

target=$1
opt=$2
shift 2

rm -f tsm-*-dbg tsm-*-static

CCOPTS="-O $opt --single-threaded --strip --library c -target $target"

echo Zig version $(./zig version)

./zig build-exe divergence.c $CCOPTS
for source in $*
do
    ./zig build-exe $source taylor-ode.c $CCOPTS
done

ls -lh --color divergence* tsm-*

echo OK
