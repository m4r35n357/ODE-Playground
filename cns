#!/bin/sh
#
#  (c) 2018-2022 m4r35n357@gmail.com (Ian Smith), for licencing see the LICENCE file
#

echo "Clean Numerical Simulation: [$0 $*]" >&2

method=$1
threshold=$2
shift 2

. ./cns-functions.sh

case $method in
    'step2') processed="$(get_precision $*)"
             halfstep $processed
             $processed >$fileB &
             wait;;
    'nosim') ;;  # replot existing data or user-supplied
          *) echo "CNS: Bad Method, should be 'step2' or 'nosim'"; exit 1;;
esac

./divergence $fileA $fileB $threshold

/usr/bin/gnuplot -p << EOF
set key horizontal left
plot '/tmp/$USER/dataA' using 4:1 t 'xA' with lines lc black, '' u 4:2 t 'yA' w l lc black, '' u 4:3 t 'zA' w l lc black, '/tmp/$USER/dataB' using 4:1 t 'xB' with lines, '' u 4:2 t 'yB' w l, '' u 4:3 t 'zB' w l
EOF
